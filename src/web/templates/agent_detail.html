<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Details - {{ source_title }}</title>
    <link rel="stylesheet" href="/static/css/base.css?v={{ cache_buster }}">
    <link rel="stylesheet" href="/static/css/agent_detail.css?v={{ cache_buster }}">
</head>

<body>
    <div class="container">
        <div class="page-header">
            <h1>{{ source_title }} - Agent</h1>
            <form action="/agents/run" method="POST" style="margin: 0;">
                <input type="hidden" name="source_id" value="{{ source_id }}">
                <button type="submit" class="add-puzzle-btn">Run Now</button>
            </form>
        </div>

        <table class="data-table info-table">
            <tr>
                <th>Agent Type</th>
                <td>{{ agent_type or 'N/A' }}</td>
            </tr>
            <tr>
                <th>Agent Enabled</th>
                <td>
                    <span class="badge {% if agent_enabled %}badge-success{% else %}badge-error{% endif %}">
                        {{ 'Yes' if agent_enabled else 'No' }}
                    </span>
                </td>
            </tr>
            <tr>
                <th>Total Runs</th>
                <td>{{ total_runs }}</td>
            </tr>
        </table>

        <table class="runs-section">
            <tr>
                <th colspan="5">Agent Runs</th>
            </tr>
            <tr class="runs-header">
                <th>Queued + Run</th>
                <th class="hide-mobile">Started</th>
                <th class="hide-mobile">Completed</th>
                <th>Status</th>
            </tr>
            {% if runs %}
            {% for run in runs %}
            <tr class="clickable-row" onclick="window.location='/agents/runs/{{ run.id }}'">
                <td>
                    <a href="/agents/runs/{{ run.id }}">
                        {% if run.queued_at %}{{ run.queued_at.strftime('%b %d, %Y %I:%M %p') }}{% else %}N/A{% endif %}
                    </a>
                </td>
                <td class="hide-mobile">
                    {% if run.started_at %}{{ run.started_at.strftime('%b %d, %Y %I:%M %p') }}{% else %}N/A{% endif %}
                </td>
                <td class="hide-mobile">
                    {% if run.completed_at %}{{ run.completed_at.strftime('%b %d, %Y %I:%M %p') }}{% else %}N/A{% endif
                    %}
                </td>
                <td>
                    <span class="badge badge-{{ run.status }}">
                        {{ run.status }}
                    </span>
                </td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="4" class="no-runs">No agent runs found</td>
            </tr>
            {% endif %}
        </table>

        {% if total_pages > 1 %}
        <div class="pagination">
            {% if page > 1 %}
            <a href="/sources/{{ source_id }}/agent?page={{ page - 1 }}" class="btn btn-link pagination-btn">←
                Previous</a>
            {% else %}
            <span class="btn btn-link pagination-btn disabled">← Previous</span>
            {% endif %}

            <span class="pagination-info">Page {{ page }} of {{ total_pages }}</span>

            {% if page < total_pages %} <a href="/sources/{{ source_id }}/agent?page={{ page + 1 }}"
                class="btn btn-link pagination-btn">Next →</a>
                {% else %}
                <span class="btn btn-link pagination-btn disabled">Next →</span>
                {% endif %}
        </div>
        {% endif %}
    </div>
</body>

</html>
